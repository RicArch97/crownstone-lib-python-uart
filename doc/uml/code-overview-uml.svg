<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="707px" preserveAspectRatio="none" style="width:1338px;height:707px;" version="1.1" viewBox="0 0 1338 707" width="1338px" zoomAndPan="magnify"><defs><filter height="300%" id="fzw15pt733foe" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[2be9421cc3470f743a6789778a73804e]
class CrownstoneUart--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="60.8047" id="CrownstoneUart" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="822.5" y="40"/><ellipse cx="837.5" cy="56" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M840.4688,61.6406 Q839.8906,61.9375 839.25,62.0781 Q838.6094,62.2344 837.9063,62.2344 Q835.4063,62.2344 834.0781,60.5938 Q832.7656,58.9375 832.7656,55.8125 Q832.7656,52.6875 834.0781,51.0313 Q835.4063,49.375 837.9063,49.375 Q838.6094,49.375 839.25,49.5313 Q839.9063,49.6875 840.4688,49.9844 L840.4688,52.7031 Q839.8438,52.125 839.25,51.8594 Q838.6563,51.5781 838.0313,51.5781 Q836.6875,51.5781 836,52.6563 Q835.3125,53.7188 835.3125,55.8125 Q835.3125,57.9063 836,58.9844 Q836.6875,60.0469 838.0313,60.0469 Q838.6563,60.0469 839.25,59.7813 Q839.8438,59.5 840.4688,58.9219 L840.4688,61.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="101" x="851.5" y="60.1543">CrownstoneUart</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="823.5" x2="954.5" y1="72" y2="72"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="51" x="828.5" y="86.2104">Main API.</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="823.5" x2="954.5" y1="92.8047" y2="92.8047"/><!--MD5=[257019a95187e6f8db1536c8cc473817]
class UartManager--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="82.4141" id="UartManager" style="stroke: #A80036; stroke-width: 1.5;" width="214" x="432" y="227"/><ellipse cx="493.75" cy="243" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M496.7188,248.6406 Q496.1406,248.9375 495.5,249.0781 Q494.8594,249.2344 494.1563,249.2344 Q491.6563,249.2344 490.3281,247.5938 Q489.0156,245.9375 489.0156,242.8125 Q489.0156,239.6875 490.3281,238.0313 Q491.6563,236.375 494.1563,236.375 Q494.8594,236.375 495.5,236.5313 Q496.1563,236.6875 496.7188,236.9844 L496.7188,239.7031 Q496.0938,239.125 495.5,238.8594 Q494.9063,238.5781 494.2813,238.5781 Q492.9375,238.5781 492.25,239.6563 Q491.5625,240.7188 491.5625,242.8125 Q491.5625,244.9063 492.25,245.9844 Q492.9375,247.0469 494.2813,247.0469 Q494.9063,247.0469 495.5,246.7813 Q496.0938,246.5 496.7188,245.9219 L496.7188,248.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="82" x="514.25" y="247.1543">UartManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="433" x2="645" y1="259" y2="259"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="202" x="438" y="273.2104">Finds and connects to UART device.</text><ellipse cx="443" cy="299.6094" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="100" x="452" y="302.8198">connectionClosed</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="433" x2="506.5" y1="286.207" y2="286.207"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="65" x="506.5" y="289.5151">Listens for:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="571.5" x2="645" y1="286.207" y2="286.207"/><!--MD5=[404ddeb7b6f904b813ee151bd1439095]
class UartBridge--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="124.8281" id="UartBridge" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="473.5" y="403"/><ellipse cx="500.2" cy="419" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M503.1688,424.6406 Q502.5906,424.9375 501.95,425.0781 Q501.3094,425.2344 500.6063,425.2344 Q498.1063,425.2344 496.7781,423.5938 Q495.4656,421.9375 495.4656,418.8125 Q495.4656,415.6875 496.7781,414.0313 Q498.1063,412.375 500.6063,412.375 Q501.3094,412.375 501.95,412.5313 Q502.6063,412.6875 503.1688,412.9844 L503.1688,415.7031 Q502.5438,415.125 501.95,414.8594 Q501.3563,414.5781 500.7313,414.5781 Q499.3875,414.5781 498.7,415.6563 Q498.0125,416.7188 498.0125,418.8125 Q498.0125,420.9063 498.7,421.9844 Q499.3875,423.0469 500.7313,423.0469 Q501.3563,423.0469 501.95,422.7813 Q502.5438,422.5 503.1688,421.9219 L503.1688,424.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="67" x="516.8" y="423.1543">UartBridge</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="474.5" x2="597.5" y1="435" y2="435"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="98" x="479.5" y="449.2104">The serial driver.</text><ellipse cx="484.5" cy="475.6094" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="493.5" y="478.8198">uartWriteData</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="474.5" x2="503.5" y1="462.207" y2="462.207"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="65" x="503.5" y="465.5151">Listens for:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="568.5" x2="597.5" y1="462.207" y2="462.207"/><polygon fill="none" points="484.5,501.2188,480.5,507.2188,488.5,507.2188" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="99" x="493.5" y="508.4292">uartWriteSuccess</text><polygon fill="none" points="484.5,514.0234,480.5,520.0234,488.5,520.0234" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="80" x="493.5" y="521.2339">uartWriteError</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="474.5" x2="518" y1="491.8164" y2="491.8164"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="36" x="518" y="495.1245">Emits:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="554" x2="597.5" y1="491.8164" y2="491.8164"/><!--MD5=[849012358916c056982cace44773d4ef]
class UartReadBuffer--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="108.0234" id="UartReadBuffer" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="339.5" y="588"/><ellipse cx="364.85" cy="604" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M367.8188,609.6406 Q367.2406,609.9375 366.6,610.0781 Q365.9594,610.2344 365.2563,610.2344 Q362.7563,610.2344 361.4281,608.5938 Q360.1156,606.9375 360.1156,603.8125 Q360.1156,600.6875 361.4281,599.0313 Q362.7563,597.375 365.2563,597.375 Q365.9594,597.375 366.6,597.5313 Q367.2563,597.6875 367.8188,597.9844 L367.8188,600.7031 Q367.1938,600.125 366.6,599.8594 Q366.0063,599.5781 365.3813,599.5781 Q364.0375,599.5781 363.35,600.6563 Q362.6625,601.7188 362.6625,603.8125 Q362.6625,605.9063 363.35,606.9844 Q364.0375,608.0469 365.3813,608.0469 Q366.0063,608.0469 366.6,607.7813 Q367.1938,607.5 367.8188,606.9219 L367.8188,609.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="381.15" y="608.1543">UartReadBuffer</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="340.5" x2="489.5" y1="620" y2="620"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="133" x="345.5" y="634.2104">Parses each read byte,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="122" x="345.5" y="647.0151">checks for start byte,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="139" x="345.5" y="659.8198">handles escaping bytes.</text><polygon fill="none" points="350.5,682.2188,346.5,688.2188,354.5,688.2188" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="94" x="359.5" y="689.4292">uartNewPackage</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="340.5" x2="397" y1="672.8164" y2="672.8164"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="36" x="397" y="676.1245">Emits:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="433" x2="489.5" y1="672.8164" y2="672.8164"/><!--MD5=[5adcea36a7b16609967ca57cee039e45]
class UartParser--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="95.2188" id="UartParser" style="stroke: #A80036; stroke-width: 1.5;" width="262" x="526" y="594.5"/><ellipse cx="618.75" cy="610.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M621.7188,616.1406 Q621.1406,616.4375 620.5,616.5781 Q619.8594,616.7344 619.1563,616.7344 Q616.6563,616.7344 615.3281,615.0938 Q614.0156,613.4375 614.0156,610.3125 Q614.0156,607.1875 615.3281,605.5313 Q616.6563,603.875 619.1563,603.875 Q619.8594,603.875 620.5,604.0313 Q621.1563,604.1875 621.7188,604.4844 L621.7188,607.2031 Q621.0938,606.625 620.5,606.3594 Q619.9063,606.0781 619.2813,606.0781 Q617.9375,606.0781 617.25,607.1563 Q616.5625,608.2188 616.5625,610.3125 Q616.5625,612.4063 617.25,613.4844 Q617.9375,614.5469 619.2813,614.5469 Q619.9063,614.5469 620.5,614.2813 Q621.0938,614 621.7188,613.4219 L621.7188,616.1406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="68" x="639.25" y="614.6543">UartParser</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="527" x2="787" y1="626.5" y2="626.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="113" x="532" y="640.7104">Parses packets and</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="250" x="532" y="653.5151">emits different events for different packets.</text><ellipse cx="537" cy="679.9141" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="94" x="546" y="683.1245">uartNewPackage</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="527" x2="624.5" y1="666.5117" y2="666.5117"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="65" x="624.5" y="669.8198">Listens for:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="689.5" x2="787" y1="666.5117" y2="666.5117"/><!--MD5=[6cf5b31bd00319e799a5cbe08293e608]
class StoneManager--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="82.4141" id="StoneManager" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="687.5" y="227"/><ellipse cx="722.75" cy="243" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M725.7188,248.6406 Q725.1406,248.9375 724.5,249.0781 Q723.8594,249.2344 723.1563,249.2344 Q720.6563,249.2344 719.3281,247.5938 Q718.0156,245.9375 718.0156,242.8125 Q718.0156,239.6875 719.3281,238.0313 Q720.6563,236.375 723.1563,236.375 Q723.8594,236.375 724.5,236.5313 Q725.1563,236.6875 725.7188,236.9844 L725.7188,239.7031 Q725.0938,239.125 724.5,238.8594 Q723.9063,238.5781 723.2813,238.5781 Q721.9375,238.5781 721.25,239.6563 Q720.5625,240.7188 720.5625,242.8125 Q720.5625,244.9063 721.25,245.9844 Q721.9375,247.0469 723.2813,247.0469 Q723.9063,247.0469 724.5,246.7813 Q725.0938,246.5 725.7188,245.9219 L725.7188,248.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="92" x="741.25" y="247.1543">StoneManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="688.5" x2="855.5" y1="259" y2="259"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="157" x="693.5" y="273.2104">Keeps up a list of stoneIds.</text><ellipse cx="698.5" cy="299.6094" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="125" x="707.5" y="302.8198">newCrownstoneFound</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="688.5" x2="739.5" y1="286.207" y2="286.207"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="65" x="739.5" y="289.5151">Listens for:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="804.5" x2="855.5" y1="286.207" y2="286.207"/><!--MD5=[14764b6015e964d23248c59771217206]
class StoneStateManager--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="124.8281" id="StoneStateManager" style="stroke: #A80036; stroke-width: 1.5;" width="282" x="634" y="403"/><ellipse cx="707.75" cy="419" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M710.7188,424.6406 Q710.1406,424.9375 709.5,425.0781 Q708.8594,425.2344 708.1563,425.2344 Q705.6563,425.2344 704.3281,423.5938 Q703.0156,421.9375 703.0156,418.8125 Q703.0156,415.6875 704.3281,414.0313 Q705.6563,412.375 708.1563,412.375 Q708.8594,412.375 709.5,412.5313 Q710.1563,412.6875 710.7188,412.9844 L710.7188,415.7031 Q710.0938,415.125 709.5,414.8594 Q708.9063,414.5781 708.2813,414.5781 Q706.9375,414.5781 706.25,415.6563 Q705.5625,416.7188 705.5625,418.8125 Q705.5625,420.9063 706.25,421.9844 Q706.9375,423.0469 708.2813,423.0469 Q708.9063,423.0469 709.5,422.7813 Q710.0938,422.5 710.7188,421.9219 L710.7188,424.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="126" x="728.25" y="423.1543">StoneStateManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="635" x2="915" y1="435" y2="435"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="270" x="640" y="449.2104">Keeps up a list of stones, with their state data.</text><ellipse cx="645" cy="475.6094" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="69" x="654" y="478.8198">stateUpdate</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="635" x2="742.5" y1="462.207" y2="462.207"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="65" x="742.5" y="465.5151">Listens for:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="807.5" x2="915" y1="462.207" y2="462.207"/><polygon fill="none" points="645,501.2188,641,507.2188,649,507.2188" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="125" x="654" y="508.4292">newCrownstoneFound</text><polygon fill="none" points="645,514.0234,641,520.0234,649,520.0234" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="99" x="654" y="521.2339">newDataAvailable</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="635" x2="757" y1="491.8164" y2="491.8164"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="36" x="757" y="495.1245">Emits:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="793" x2="915" y1="491.8164" y2="491.8164"/><!--MD5=[f6aa330fb470b2cf56f08a2599ee0bfa]
class MeshHandler--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="137.6328" id="MeshHandler" style="stroke: #A80036; stroke-width: 1.5;" width="230" x="891" y="199"/><ellipse cx="960.75" cy="215" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M963.7188,220.6406 Q963.1406,220.9375 962.5,221.0781 Q961.8594,221.2344 961.1563,221.2344 Q958.6563,221.2344 957.3281,219.5938 Q956.0156,217.9375 956.0156,214.8125 Q956.0156,211.6875 957.3281,210.0313 Q958.6563,208.375 961.1563,208.375 Q961.8594,208.375 962.5,208.5313 Q963.1563,208.6875 963.7188,208.9844 L963.7188,211.7031 Q963.0938,211.125 962.5,210.8594 Q961.9063,210.5781 961.2813,210.5781 Q959.9375,210.5781 959.25,211.6563 Q958.5625,212.7188 958.5625,214.8125 Q958.5625,216.9063 959.25,217.9844 Q959.9375,219.0469 961.2813,219.0469 Q961.9063,219.0469 962.5,218.7813 Q963.0938,218.5 963.7188,217.9219 L963.7188,220.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="82" x="981.25" y="219.1543">MeshHandler</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="892" x2="1120" y1="231" y2="231"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="218" x="897" y="245.2104">API to send commands into the mesh.</text><ellipse cx="902" cy="271.6094" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="70" x="911" y="274.8198">resultPacket</text><ellipse cx="902" cy="284.4141" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="104" x="911" y="287.6245">meshResultPacket</text><ellipse cx="902" cy="297.2188" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="130" x="911" y="300.4292">meshResultFinalPacket</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="892" x2="973.5" y1="258.207" y2="258.207"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="65" x="973.5" y="261.5151">Listens for:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="1038.5" x2="1120" y1="258.207" y2="258.207"/><polygon fill="none" points="902,322.8281,898,328.8281,906,328.8281" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="911" y="330.0386">uartWriteData</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="892" x2="988" y1="313.4258" y2="313.4258"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="36" x="988" y="316.7339">Emits:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="1024" x2="1120" y1="313.4258" y2="313.4258"/><!--MD5=[0b897466b823e6b7dd34756f740ca966]
class UsbDevHandler--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="82.4141" id="UsbDevHandler" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="1156.5" y="227"/><ellipse cx="1190.85" cy="243" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1193.8188,248.6406 Q1193.2406,248.9375 1192.6,249.0781 Q1191.9594,249.2344 1191.2563,249.2344 Q1188.7563,249.2344 1187.4281,247.5938 Q1186.1156,245.9375 1186.1156,242.8125 Q1186.1156,239.6875 1187.4281,238.0313 Q1188.7563,236.375 1191.2563,236.375 Q1191.9594,236.375 1192.6,236.5313 Q1193.2563,236.6875 1193.8188,236.9844 L1193.8188,239.7031 Q1193.1938,239.125 1192.6,238.8594 Q1192.0063,238.5781 1191.3813,238.5781 Q1190.0375,238.5781 1189.35,239.6563 Q1188.6625,240.7188 1188.6625,242.8125 Q1188.6625,244.9063 1189.35,245.9844 Q1190.0375,247.0469 1191.3813,247.0469 Q1192.0063,247.0469 1192.6,246.7813 Q1193.1938,246.5 1193.8188,245.9219 L1193.8188,248.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="1209.15" y="247.1543">UsbDevHandler</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1157.5" x2="1326.5" y1="259" y2="259"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="159" x="1162.5" y="273.2104">API to send dev commands.</text><polygon fill="none" points="1167.5,295.6094,1163.5,301.6094,1171.5,301.6094" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="1176.5" y="302.8198">uartWriteData</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="1157.5" x2="1224" y1="286.207" y2="286.207"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="36" x="1224" y="289.5151">Emits:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="1260" x2="1326.5" y1="286.207" y2="286.207"/><!--MD5=[50d96c22713d424af63edc7074a10a5c]
class Collector--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="124.8281" id="Collector" style="stroke: #A80036; stroke-width: 1.5;" width="164" x="23" y="8"/><ellipse cx="73.25" cy="24" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M76.2188,29.6406 Q75.6406,29.9375 75,30.0781 Q74.3594,30.2344 73.6563,30.2344 Q71.1563,30.2344 69.8281,28.5938 Q68.5156,26.9375 68.5156,23.8125 Q68.5156,20.6875 69.8281,19.0313 Q71.1563,17.375 73.6563,17.375 Q74.3594,17.375 75,17.5313 Q75.6563,17.6875 76.2188,17.9844 L76.2188,20.7031 Q75.5938,20.125 75,19.8594 Q74.4063,19.5781 73.7813,19.5781 Q72.4375,19.5781 71.75,20.6563 Q71.0625,21.7188 71.0625,23.8125 Q71.0625,25.9063 71.75,26.9844 Q72.4375,28.0469 73.7813,28.0469 Q74.4063,28.0469 75,27.7813 Q75.5938,27.5 76.2188,26.9219 L76.2188,29.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="55" x="93.75" y="28.1543">Collector</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="24" x2="186" y1="40" y2="40"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="141" x="29" y="54.2104">Listens for a given topic,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="121" x="29" y="67.0151">waits for 1 event and</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="127" x="29" y="79.8198">stores the event data,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="117" x="29" y="92.6245">then stops listening.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="24" x2="186" y1="99.2188" y2="99.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="24" x2="186" y1="101.2188" y2="101.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="134" x="29" y="113.4292">Returns the event data,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="152" x="29" y="126.2339">or None when it times out.</text><!--MD5=[735c2676cb8c25751b09c3e1d9b336dc]
class BatchCollector--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="112.0234" id="BatchCollector" style="stroke: #A80036; stroke-width: 1.5;" width="244" x="222" y="14.5"/><ellipse cx="294.25" cy="30.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M297.2188,36.1406 Q296.6406,36.4375 296,36.5781 Q295.3594,36.7344 294.6563,36.7344 Q292.1563,36.7344 290.8281,35.0938 Q289.5156,33.4375 289.5156,30.3125 Q289.5156,27.1875 290.8281,25.5313 Q292.1563,23.875 294.6563,23.875 Q295.3594,23.875 296,24.0313 Q296.6563,24.1875 297.2188,24.4844 L297.2188,27.2031 Q296.5938,26.625 296,26.3594 Q295.4063,26.0781 294.7813,26.0781 Q293.4375,26.0781 292.75,27.1563 Q292.0625,28.2188 292.0625,30.3125 Q292.0625,32.4063 292.75,33.4844 Q293.4375,34.5469 294.7813,34.5469 Q295.4063,34.5469 296,34.2813 Q296.5938,34 297.2188,33.4219 L297.2188,36.1406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="91" x="314.75" y="34.6543">BatchCollector</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="223" x2="465" y1="46.5" y2="46.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="141" x="228" y="60.7104">Listens for a given topic,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="121" x="228" y="73.5151">waits for 1 event and</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="127" x="228" y="86.3198">stores the event data.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="223" x2="465" y1="92.9141" y2="92.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="223" x2="465" y1="94.9141" y2="94.9141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="232" x="228" y="107.1245">By repeatidly calling receive() and clear()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="181" x="228" y="119.9292">you get data of multiple events.</text><!--MD5=[bbd212f896d2e93d33d5b8c6ec9892e0]
class UartWriter--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="150.4375" id="UartWriter" style="stroke: #A80036; stroke-width: 1.5;" width="198" x="6" y="193"/><ellipse cx="68.75" cy="209" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M71.7188,214.6406 Q71.1406,214.9375 70.5,215.0781 Q69.8594,215.2344 69.1563,215.2344 Q66.6563,215.2344 65.3281,213.5938 Q64.0156,211.9375 64.0156,208.8125 Q64.0156,205.6875 65.3281,204.0313 Q66.6563,202.375 69.1563,202.375 Q69.8594,202.375 70.5,202.5313 Q71.1563,202.6875 71.7188,202.9844 L71.7188,205.7031 Q71.0938,205.125 70.5,204.8594 Q69.9063,204.5781 69.2813,204.5781 Q67.9375,204.5781 67.25,205.6563 Q66.5625,206.7188 66.5625,208.8125 Q66.5625,210.9063 67.25,211.9844 Q67.9375,213.0469 69.2813,213.0469 Q69.9063,213.0469 70.5,212.7813 Q71.0938,212.5 71.7188,211.9219 L71.7188,214.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="64" x="89.25" y="213.1543">UartWriter</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="203" y1="225" y2="225"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="12" y="239.2104">Writes a command, and</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="186" x="12" y="252.0151">waits for the result packet reply.</text><ellipse cx="17" cy="278.4141" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="70" x="26" y="281.6245">resultPacket</text><ellipse cx="17" cy="291.2188" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="99" x="26" y="294.4292">uartWriteSuccess</text><ellipse cx="17" cy="304.0234" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="80" x="26" y="307.2339">uartWriteError</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="7" x2="72.5" y1="265.0117" y2="265.0117"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="65" x="72.5" y="268.3198">Listens for:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="137.5" x2="203" y1="265.0117" y2="265.0117"/><polygon fill="none" points="17,329.6328,13,335.6328,21,335.6328" style="stroke: #1963A0; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="26" y="336.8433">uartWriteData</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="7" x2="87" y1="320.2305" y2="320.2305"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="36" x="87" y="323.5386">Emits:</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="123" x2="203" y1="320.2305" y2="320.2305"/><!--MD5=[5e9f93a130fbe2d59f2837199eb73ff6]
class UartWrapper--><rect fill="#FEFECE" filter="url(#fzw15pt733foe)" height="86.4141" id="UartWrapper" style="stroke: #A80036; stroke-width: 1.5;" width="158" x="239" y="225"/><ellipse cx="274.7" cy="241" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M277.6688,246.6406 Q277.0906,246.9375 276.45,247.0781 Q275.8094,247.2344 275.1063,247.2344 Q272.6063,247.2344 271.2781,245.5938 Q269.9656,243.9375 269.9656,240.8125 Q269.9656,237.6875 271.2781,236.0313 Q272.6063,234.375 275.1063,234.375 Q275.8094,234.375 276.45,234.5313 Q277.1063,234.6875 277.6688,234.9844 L277.6688,237.7031 Q277.0438,237.125 276.45,236.8594 Q275.8563,236.5781 275.2313,236.5781 Q273.8875,236.5781 273.2,237.6563 Q272.5125,238.7188 272.5125,240.8125 Q272.5125,242.9063 273.2,243.9844 Q273.8875,245.0469 275.2313,245.0469 Q275.8563,245.0469 276.45,244.7813 Q277.0438,244.5 277.6688,243.9219 L277.6688,246.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="80" x="293.3" y="245.1543">UartWrapper</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="240" x2="396" y1="257" y2="257"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="146" x="245" y="271.2104">Adds start token, header,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="115" x="245" y="284.0151">and CRC to payload.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="87" x="245" y="296.8198">Escapes bytes.</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="240" x2="396" y1="303.4141" y2="303.4141"/><!--MD5=[fd6b43d5144bfcf47414d9cdd2e42a56]
link CrownstoneUart to UartManager--><path d="M834.0139,101.0582 C789.6714,125.7492 725.7341,161.4589 670,193 C650.6135,203.9712 629.6588,215.9252 610.3145,226.9999 " fill="none" id="CrownstoneUart-UartManager" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[eb31772cb67c40bb787e7c512634c74f]
link UartManager to UartBridge--><path d="M538.3711,309.4025 C537.9605,336.4362 537.4165,372.245 536.9532,402.7458 " fill="none" id="UartManager-UartBridge" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[d06e80310e388def2fb6b615c8a96eb2]
link UartBridge to UartReadBuffer--><path d="M492.9992,528.2243 C479.6175,547.7439 464.9861,569.0864 452.0477,587.9593 " fill="none" id="UartBridge-UartReadBuffer" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[37c8fc27f35f13ab0941caead21018c3]
link UartBridge to UartParser--><path d="M579.0008,528.2243 C593.9448,550.0228 610.4474,574.0948 624.4101,594.4618 " fill="none" id="UartBridge-UartParser" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[b06394703af7231a075587e0f5dfef7a]
link CrownstoneUart to StoneManager--><path d="M870.7188,101.3594 C850.7308,135.0998 818.6017,189.3348 796.4558,226.7178 " fill="none" id="CrownstoneUart-StoneManager" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[8f94541e4925e8a94fc67f6ccdc06ead]
link StoneManager to StoneStateManager--><path d="M772.6289,309.4025 C773.0395,336.4362 773.5835,372.245 774.0468,402.7458 " fill="none" id="StoneManager-StoneStateManager" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[82eb80482da17bd5d65918528390e6d8]
link CrownstoneUart to MeshHandler--><path d="M907.2813,101.3594 C922.7061,127.397 945.3612,165.6397 965.0791,198.9241 " fill="none" id="CrownstoneUart-MeshHandler" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[cc3c8584446ba6015efe8c70b19d0cc3]
link CrownstoneUart to UsbDevHandler--><path d="M955.6575,99.3321 C1006.9957,122.4423 1079.0826,156.8803 1139,193 C1155.8604,203.1639 1173.4467,215.3256 1189.2162,226.8675 " fill="none" id="CrownstoneUart-UsbDevHandler" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[a2bf7b951cfc2fbb4ada2fe23518d380]
link Collector to BatchCollector--><!--MD5=[bf646e217e68dbc2c95ea11aa65159b7]
link Collector to UartWriter--><!--MD5=[a73940a43553f62f44d844c2ecc1446d]
link UartWriter to UartWrapper--><!--MD5=[5f8a530ac120da2fe969789f7db3cf66]
@startuml

class CrownstoneUart {
  Main API.
}

class UartManager {
	Finds and connects to UART device.
	.. Listens for: ..
	+ connectionClosed
}

class UartBridge {
	The serial driver.
	.. Listens for: ..
	+ uartWriteData
	.. Emits: ..
	~ uartWriteSuccess
	~ uartWriteError
}

class UartReadBuffer {
	Parses each read byte,
	checks for start byte,
	handles escaping bytes.
	.. Emits: ..
	~ uartNewPackage
}

class UartParser {
	Parses packets and
	emits different events for different packets.
	.. Listens for: ..
	+ uartNewPackage
}

class StoneManager {
	Keeps up a list of stoneIds.
	.. Listens for: ..
	+ newCrownstoneFound
}

class StoneStateManager {
	Keeps up a list of stones, with their state data.
	.. Listens for: ..
	+ stateUpdate
	.. Emits: ..
	~ newCrownstoneFound
	~ newDataAvailable
}

class MeshHandler {
	API to send commands into the mesh.
	.. Listens for: ..
	+ resultPacket
	+ meshResultPacket
	+ meshResultFinalPacket
	.. Emits: ..
	~ uartWriteData
}

class UsbDevHandler {
	API to send dev commands.
	.. Emits: ..
	~ uartWriteData
}

class Collector {
	Listens for a given topic,
	waits for 1 event and
	stores the event data,
	then stops listening.
	==
	Returns the event data,
	or None when it times out.
}

class BatchCollector {
	Listens for a given topic,
	waits for 1 event and
	stores the event data.
	==
	By repeatidly calling receive() and clear()
	you get data of multiple events.
}

class UartWriter {
	Writes a command, and
	waits for the result packet reply.
	.. Listens for: ..
	+ resultPacket
	+ uartWriteSuccess
	+ uartWriteError
	.. Emits: ..
	~ uartWriteData
}

class UartWrapper {
	Adds start token, header,
	and CRC to payload.
	Escapes bytes.
}


CrownstoneUart - - UartManager
UartManager - - UartBridge
UartBridge - - UartReadBuffer
UartBridge - - UartParser
CrownstoneUart - - StoneManager
StoneManager - - StoneStateManager
CrownstoneUart - - MeshHandler
CrownstoneUart - - UsbDevHandler


@enduml

PlantUML version 1.2020.00(Sat Jan 11 13:30:53 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.8+10-post-Ubuntu-0ubuntu118.04.1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>